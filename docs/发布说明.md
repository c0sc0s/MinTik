# MinTik 发版步骤（简单版）

## 无开发者账号（直接可分发）
1) 构建安装包
```bash
bash scripts/build-and-package.sh MinTik 1.0.0 dist
```
产物位置：`dist/MinTik.dmg`（应用包在 `build/MinTik.app`）

⚠️ 重要提醒：用户必须将 MinTik 拖放到 `/Applications` 文件夹后，再打开应用，否则将无法正常工作。

2) 编辑发布说明
- 打开并填写本次更新：`RELEASE_NOTES.md`
- 附上用户安装提示，确保用户知道如何处理"无法验证开发者"的错误：

### 安装注意事项：

⚠️ 重要声明：由于 MinTik 是未使用 Apple 开发者 ID 签名的应用程序，因此在首次打开时会显示安全警告。这是 macOS 的默认安全机制，并非因为应用程序存在安全问题。

#### 方法一：通过系统设置允许（推荐）
1. 尝试直接打开 MinTik，您会看到"无法验证开发者"的提示
2. 打开「系统设置」→ 「隐私与安全性」
3. 在页面底部找到「安全性」部分，您会看到 "MinTik 已被阻止，因为它是由未识别的开发者制作的" 提示
4. 点击「仍要打开」按钮
5. 在新弹出的窗口中再次点击「打开」

#### 方法二：通过 Control+点击打开
如果方法一无法解决，您可以尝试以下步骤：
1. 按住 `Control` 键并点击 MinTik 应用图标
2. 在弹出的菜单中选择 "打开"
3. 在新弹出的窗口中再次点击 "打开"

#### 方法三：永久移除隔离属性
如果您希望完全移除这个提示，可以在终端中运行以下命令：
```bash
sudo xattr -dr com.apple.quarantine /Applications/MinTik.app
```

#### 针对 macOS Ventura 及以后版本的特殊说明
在 macOS Ventura 及以后的版本中，默认隐藏了"允许任何来源"的选项。如果您遇到问题，可以通过以下终端命令启用该选项：
```bash
sudo spctl --master-disable
```
启用后，您将在「系统设置」→ 「隐私与安全性」→ 「通用」中看到"允许从以下位置下载的应用：任何来源"的选项。

3) 发布到 GitHub Release
```bash
bash scripts/release.sh v1.0.0
```
把 `v1.0.0` 换成你的版本号；脚本会上传 `dist/MinTik.dmg` 并创建 Release。

## 有开发者账号（可直接打开）
```bash
BUNDLE_ID_PREFIX=com.yourcompany \
CODESIGN_IDENTITY="Developer ID Application: Your Name (TEAMID)" \
NOTARY_PROFILE=mintik-notary \
bash scripts/build-and-package.sh MinTik 1.0.0 dist
```
（可选）校验 DMG：`xcrun stapler validate dist/MinTik.dmg`

## 需要的工具
- `xcode-select --install`、`swift`、`node/npm`、`gh`
- 首次发布需登录 GitHub：`gh auth login`

## 发布官网（GitHub Pages）
- 自动发布（推荐）
  - 推送版本标签：
    ```bash
    git tag v1.0.0 && git push origin v1.0.0
    ```
  - 自动执行工作流：构建 DMG、创建 Release、将 `web/` 部署到 Pages。
  - 访问地址：`https://<owner>.github.io/<repo>/`（首次启用可在仓库 Settings → Pages 确认已开启）。
  - 前端下载按钮会自动解析“最新 Release”的 DMG，无需手动改链接。
  - 如仓库所有者或名字变化，修改常量：`web/index.html:1064` 中的 `const REPO = 'c0sc0s/MinTik'`。

- 手动发布
  - 直接使用脚本并开启网页部署：
    ```bash
    DEPLOY_WEB=true bash scripts/release.sh v1.0.0
    ```
  - 或仅部署网站（不走脚本的发布流程）：
    ```bash
    git subtree split --prefix web -b gh-pages-tmp
    git push -f origin gh-pages-tmp:gh-pages
    git branch -D gh-pages-tmp
    ```
