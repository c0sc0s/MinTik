# MinTik v1.1.0 更新说明

发布日期：2025-11-25

## 🎨 UI/UX 优化

### Popover 窗口优化

- **修复窗口闪烁问题**

  - 移除了系统 Popover 动画，改用自定义 SwiftUI 动画
  - 优化了窗口激活逻辑，确保窗口打开时立即聚焦
  - 解决了 `.vibrantDark` appearance 与 SwiftUI 渲染的冲突

- **自定义入场动画**
  - 添加了平滑的缩放动画（0.9 → 1.0）
  - 添加了垂直位移效果（从上方 -10px 滑入）
  - 添加了淡入效果（透明度 0 → 1）
  - 使用弹簧动画（response: 0.35s, damping: 0.75）提供自然的动效
  - 每次打开窗口都会重新播放动画

### 界面细节改进

- **Tab 切换器背景调整**

  - 将背景透明度从 0.6 降低到 0.35
  - 提升了图标的可见度和整体美观度

- **计时器字体自适应**
  - 当时间达到 100 分钟（三位数）时，字体自动从 58 缩小到 42
  - 添加了 `.minimumScaleFactor(0.5)` 确保文本完整显示
  - 调整了字符间距（tracking 和 kerning）以适应不同长度的时间显示
  - 避免了长时间工作时出现的文本截断问题

## 🔔 通知系统增强

### 提示音优化

- **独立音频播放**

  - 使用 AVFoundation 框架直接播放系统声音
  - 不再依赖系统通知的声音设置
  - 选用 Glass.aiff（约 2 秒的清脆提示音）作为默认提示音
  - 确保即使通知权限受限也能播放提示音

- **测试功能**
  - 在设置页面添加了"测试通知声音"按钮
  - 方便用户预览通知效果和声音
  - 只在通知权限已授权时显示

## 🐛 Bug 修复

### 窗口焦点问题

- 修复了窗口打开时默认失焦（灰色）的问题
- 优化了窗口激活时序，确保立即获得焦点
- 移除了导致闪烁的冗余 `makeKey()` 调用

### 动画稳定性

- 解决了 Popover 动画与窗口激活冲突导致的闪烁
- 通过通知机制确保每次打开都能触发入场动画
- 修复了动画只在首次显示的问题

## 🔧 技术改进

### 代码优化

- 添加了 AVFoundation 框架支持
- 优化了窗口生命周期管理
- 改进了动画触发机制（使用 NotificationCenter）
- 增强了音频播放的可靠性

### 架构改进

- 分离了通知显示和音频播放逻辑
- 提供了更灵活的提示音配置方式
- 改进了窗口状态管理

## 📝 已知问题

- 通知权限检查在某些环境下会显示错误信息（不影响功能）
- 使用 `swift run` 运行时 Bundle ID 为 nil（已通过默认值解决）

## 🎯 下一步计划

- 支持自定义提示音
- 添加更多主题选项
- 优化数据持久化机制
- 改进通知权限处理

---

**完整更新日志**：查看 [CHANGELOG.md](../CHANGELOG.md)
**问题反馈**：[GitHub Issues](https://github.com/yourusername/MinTik/issues)
